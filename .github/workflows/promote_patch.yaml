name: Promote GPT Patch

on:
  push:
    paths:
      - '.patches/*.diff'

jobs:
  promote:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Git config
        run: |
          git config --global user.name "chatgpt-bot"
          git config --global user.email "chatgpt-bot@users.noreply.github.com"

      - name: Extract triggered patch name
        id: extract
        run: |
          echo "TRIGGERED_PATCH=$(basename '${{ github.event.head_commit.added[0] }}')" >> $GITHUB_ENV

      - name: Debug output
        run: echo "Triggered patch: ${{ env.TRIGGERED_PATCH }}"

      - name: Promote patch to feature branch
        run: bash scripts/create_pr_from_patch.sh
        env:
          TRIGGERED_PATCH: ${{ env.TRIGGERED_PATCH }}
